---
phase: 01-foundation
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - app.json
  - eas.json
  - tsconfig.json
  - eslint.config.js
  - .prettierrc
  - .gitignore
  - .env.example
  - .vscode/settings.json
  - .husky/pre-commit
autonomous: true
requirements: []

must_haves:
  truths:
    - "Running `npx tsc --noEmit` exits with 0 errors on the project scaffold"
    - "Running `npx eslint .` exits with 0 errors (TypeScript files pass linting)"
    - "`eas.json` defines development, preview, and production build profiles"
    - "`app.json` contains `UIBackgroundModes: [audio]` under `ios.infoPlist` and references `expo-audio`, `expo-build-properties`, and all 5 RNFB config plugins"
    - "Committing a staged file with a Prettier violation causes the pre-commit hook to fail (lint-staged blocks the commit)"
    - "`.env.example` contains all 13 EXPO_PUBLIC_ keys across Firebase, RevenueCat, and Unity Ads with empty values"
  artifacts:
    - path: "app.json"
      provides: "Expo config with UIBackgroundModes and all RNFB + expo-audio plugins"
      contains: "UIBackgroundModes"
    - path: "eas.json"
      provides: "EAS build profiles (development, preview, production)"
      contains: "developmentClient"
    - path: "tsconfig.json"
      provides: "Moderate strict TypeScript config"
      contains: "strictNullChecks"
    - path: "eslint.config.js"
      provides: "Flat ESLint config with Prettier integration"
      contains: "prettier/prettier"
    - path: ".prettierrc"
      provides: "Prettier formatting rules"
      contains: "singleQuote"
    - path: ".husky/pre-commit"
      provides: "Pre-commit hook running lint-staged"
      contains: "lint-staged"
    - path: ".env.example"
      provides: "Template for all environment variables across all phases"
      contains: "EXPO_PUBLIC_FIREBASE_API_KEY"
  key_links:
    - from: ".husky/pre-commit"
      to: "lint-staged config in package.json"
      via: "npx lint-staged"
      pattern: "lint-staged"
    - from: "eslint.config.js"
      to: "eslint-config-expo + prettier"
      via: "module imports"
      pattern: "eslint-config-expo"
    - from: "app.json"
      to: "expo-build-properties plugin"
      via: "plugins array"
      pattern: "expo-build-properties"
---

<objective>
Bootstrap the Expo project with all native configuration required for EAS Development Builds: app.json with UIBackgroundModes and all plugin declarations, eas.json with build profiles, TypeScript moderate-strict config, ESLint + Prettier enforced at commit via lint-staged + Husky, and the full .env.example template.

Purpose: This plan establishes the non-negotiable infrastructure foundation. Every subsequent phase depends on the native build config (app.json plugins, eas.json) and the linting guardrails (TypeScript, ESLint, Prettier, lint-staged) being correct before any product code is written.

Output: A configured Expo project with working toolchain — no placeholder screens yet, just the infrastructure layer.
</objective>

<execution_context>
@/Users/manuelfrancogiraldez/.claude/get-shit-done/workflows/execute-plan.md
@/Users/manuelfrancogiraldez/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install all dependencies and configure app.json + eas.json</name>
  <files>
    package.json
    app.json
    eas.json
  </files>
  <action>
**Step 1 — Install packages.**

The project was created with `create-expo-app` using the blank-typescript template. Install all Phase 1 dependencies:

```bash
# RNFB and required native support
npx expo install expo-dev-client expo-build-properties expo-audio
npx expo install @react-native-firebase/app @react-native-firebase/auth \
  @react-native-firebase/firestore @react-native-firebase/storage \
  @react-native-firebase/analytics

# State management
npm install zustand

# Linting + formatting + git hooks
npm install --save-dev eslint-config-expo prettier eslint-config-prettier \
  eslint-plugin-prettier husky lint-staged

# AsyncStorage (required by RNFB Auth for token persistence)
npx expo install @react-native-async-storage/async-storage
```

**Step 2 — Configure app.json.**

Replace the contents of `app.json` with the full configuration below. Key requirements:
- `scheme: "calm-sounds"` — required by Expo Router for deep linking (missing scheme breaks navigation initialization)
- `ios.infoPlist.UIBackgroundModes: ["audio"]` — the non-negotiable native capability for this app
- `ios.googleServicesFile` and `android.googleServicesFile` — point to the native Firebase config files
- All 5 RNFB plugins declared (app, auth, firestore, storage, analytics)
- `expo-build-properties` plugin with `useFrameworks: static` for iOS (required for RNFB — without it iOS builds fail with non-modular header errors)
- `expo-audio` plugin with `microphonePermission: false` (this app never needs microphone)
- `newArchEnabled: true` — keep New Architecture enabled; RNFB v23 officially supports it

```json
{
  "expo": {
    "name": "Calm Sounds",
    "slug": "calm-asmr-sounds",
    "version": "1.0.0",
    "scheme": "calm-sounds",
    "orientation": "portrait",
    "userInterfaceStyle": "dark",
    "newArchEnabled": true,
    "ios": {
      "supportsTablet": false,
      "bundleIdentifier": "com.calmsounds.app",
      "googleServicesFile": "./GoogleService-Info.plist",
      "infoPlist": {
        "UIBackgroundModes": ["audio"]
      }
    },
    "android": {
      "adaptiveIcon": {
        "foregroundImage": "./assets/images/adaptive-icon.png",
        "backgroundColor": "#000000"
      },
      "package": "com.calmsounds.app",
      "googleServicesFile": "./google-services.json"
    },
    "plugins": [
      "expo-router",
      "@react-native-firebase/app",
      "@react-native-firebase/auth",
      "@react-native-firebase/firestore",
      "@react-native-firebase/storage",
      "@react-native-firebase/analytics",
      [
        "expo-build-properties",
        {
          "ios": {
            "useFrameworks": "static"
          }
        }
      ],
      [
        "expo-audio",
        {
          "microphonePermission": false
        }
      ]
    ],
    "experiments": {
      "typedRoutes": true
    }
  }
}
```

**Step 3 — Create eas.json.**

Create `eas.json` at the project root with three build profiles. The `development` profile is the primary Phase 1 deliverable — it produces an installable Development Build containing the expo-dev-client and all native modules (RNFB, expo-audio). The `preview` profile produces a non-development internal distribution build for QA. The `production` profile is for App Store / Play Store submissions.

```json
{
  "cli": {
    "version": ">= 16.0.0",
    "appVersionSource": "local"
  },
  "build": {
    "development": {
      "developmentClient": true,
      "distribution": "internal",
      "env": {
        "APP_VARIANT": "development"
      }
    },
    "preview": {
      "distribution": "internal",
      "env": {
        "APP_VARIANT": "preview"
      }
    },
    "production": {
      "autoIncrement": true,
      "env": {
        "APP_VARIANT": "production"
      }
    }
  },
  "submit": {
    "production": {}
  }
}
```

**Step 4 — Update package.json scripts and lint-staged config.**

Add to the `scripts` section of `package.json`:
```json
"prepare": "husky",
"lint": "expo lint",
"lint:fix": "expo lint --fix"
```

Add `lint-staged` configuration to `package.json` (top-level key, not inside `scripts`):
```json
"lint-staged": {
  "*.{ts,tsx}": [
    "eslint --max-warnings=0 --fix",
    "prettier --write"
  ],
  "*.{json,md}": [
    "prettier --write"
  ]
}
```

The `--max-warnings=0` flag implements the decision: ESLint warnings block commits, warnings are informational only in the IDE.

**Step 5 — Initialize Husky and create pre-commit hook.**

```bash
npx husky init
echo "npx lint-staged" > .husky/pre-commit
chmod +x .husky/pre-commit
```

**Step 6 — Update .gitignore.**

Ensure `.gitignore` includes `.env` but NOT `google-services.json` or `GoogleService-Info.plist` (per locked decision — these are committed). Add if missing:
```
.env
*.local
.expo/
node_modules/
dist/
```

Do NOT add `google-services.json` or `GoogleService-Info.plist` to `.gitignore`.
  </action>
  <verify>
```bash
# Verify package installations
cat package.json | grep -E '"@react-native-firebase|expo-dev-client|expo-build-properties|expo-audio|zustand|husky|lint-staged'

# Verify app.json has UIBackgroundModes
cat app.json | grep -A2 "UIBackgroundModes"

# Verify app.json has useFrameworks: static
cat app.json | grep "useFrameworks"

# Verify eas.json has development profile
cat eas.json | grep "developmentClient"

# Verify husky pre-commit hook exists
cat .husky/pre-commit
```
  </verify>
  <done>
- `package.json` contains all RNFB modules, expo-dev-client, expo-build-properties, expo-audio, zustand, husky, lint-staged
- `app.json` contains `UIBackgroundModes: ["audio"]`, `useFrameworks: static`, all 5 RNFB plugins, expo-audio plugin, `scheme: "calm-sounds"`
- `eas.json` contains development (developmentClient: true), preview, and production profiles
- `.husky/pre-commit` exists and contains `npx lint-staged`
- `.gitignore` includes `.env` but does NOT include `google-services.json` or `GoogleService-Info.plist`
  </done>
</task>

<task type="auto">
  <name>Task 2: TypeScript config, ESLint + Prettier, .env.example, VS Code settings</name>
  <files>
    tsconfig.json
    eslint.config.js
    .prettierrc
    .env.example
    .vscode/settings.json
  </files>
  <action>
**Step 1 — Configure tsconfig.json (moderate strict).**

Replace or create `tsconfig.json` with:
```json
{
  "extends": "expo/tsconfig.base",
  "compilerOptions": {
    "strict": false,
    "strictNullChecks": true,
    "noImplicitAny": true,
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["**/*.ts", "**/*.tsx", ".expo/types/**/*.d.ts", "expo-env.d.ts"]
}
```

Rationale: `expo/tsconfig.base` provides Expo-recommended defaults. We set `strict: false` then re-enable individual flags — this is the "moderate strict" profile from the locked decision. The `@/*` alias maps to `src/` for clean imports.

**Step 2 — Create eslint.config.js (flat config format, SDK 53+ standard).**

Delete any existing `.eslintrc.*` files. Create `eslint.config.js`:

```javascript
const { defineConfig } = require('eslint/config');
const expoConfig = require('eslint-config-expo/flat');
const prettierConfig = require('eslint-config-prettier');
const prettierPlugin = require('eslint-plugin-prettier');

module.exports = defineConfig([
  ...expoConfig,
  prettierConfig,
  {
    plugins: { prettier: prettierPlugin },
    rules: {
      'prettier/prettier': 'error',
    },
  },
  {
    ignores: ['dist/', 'node_modules/', '.expo/'],
  },
]);
```

Note: `eslint-config-prettier` disables ESLint rules that would conflict with Prettier's formatting. `eslint-plugin-prettier` runs Prettier as an ESLint rule so violations appear as ESLint errors. This combination is the standard approach.

**Step 3 — Create .prettierrc.**

```json
{
  "semi": true,
  "singleQuote": true,
  "trailingComma": "all",
  "printWidth": 100,
  "tabWidth": 2,
  "bracketSameLine": false
}
```

**Step 4 — Create .env.example.**

This is the full template for ALL environment variables across all phases (Firebase, RevenueCat, Unity Ads). Actual values are NOT included — this is a template only. The `.env` file (with real values) is gitignored.

Note from research: With RNFB, the actual Firebase mobile connection uses `google-services.json` / `GoogleService-Info.plist` (native). The `EXPO_PUBLIC_FIREBASE_*` variables are present for consistency with the locked decision pattern and for any JS-side utilities, but RNFB auto-initializes from native config files without needing these at runtime.

```bash
# .env.example
# Copy this file to .env and fill in real values.
# .env is gitignored. Only .env.example is committed.

# Firebase Web SDK config (EXPO_PUBLIC_ = inlined into app bundle at build time)
# Note: RNFB uses google-services.json / GoogleService-Info.plist for native mobile.
# These vars are for consistency and any JS-side Firebase usage.
EXPO_PUBLIC_FIREBASE_API_KEY=
EXPO_PUBLIC_FIREBASE_AUTH_DOMAIN=
EXPO_PUBLIC_FIREBASE_PROJECT_ID=
EXPO_PUBLIC_FIREBASE_STORAGE_BUCKET=
EXPO_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=
EXPO_PUBLIC_FIREBASE_APP_ID=
EXPO_PUBLIC_FIREBASE_MEASUREMENT_ID=

# RevenueCat (Phase 6 — separate keys for iOS and Android)
EXPO_PUBLIC_REVENUECAT_API_KEY_IOS=
EXPO_PUBLIC_REVENUECAT_API_KEY_ANDROID=

# Unity Ads (Phase 6 — Game IDs and placement IDs embedded in bundle)
EXPO_PUBLIC_UNITY_GAME_ID_IOS=
EXPO_PUBLIC_UNITY_GAME_ID_ANDROID=
EXPO_PUBLIC_UNITY_PLACEMENT_ID_REWARDED=
EXPO_PUBLIC_UNITY_PLACEMENT_ID_INTERSTITIAL=
```

**Step 5 — Create .vscode/settings.json.**

Create the `.vscode/` directory if it does not exist. This file is committed per locked decision.

```json
{
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": "explicit"
  },
  "[typescript]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[typescriptreact]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  }
}
```
  </action>
  <verify>
```bash
# Verify TypeScript compiles the scaffold
npx tsc --noEmit

# Verify ESLint runs without configuration errors
npx eslint . --ext .ts,.tsx --max-warnings=0

# Verify .env.example has all expected keys
cat .env.example | grep EXPO_PUBLIC_ | wc -l
# Expected: 13

# Verify .prettierrc exists
cat .prettierrc

# Verify VS Code settings committed
cat .vscode/settings.json | grep "formatOnSave"
```
  </verify>
  <done>
- `tsconfig.json` has `strictNullChecks: true`, `noImplicitAny: true`, `strict: false`, and `@/*` path alias
- `eslint.config.js` is flat config format with eslint-config-expo + prettier integration; `npx eslint .` exits 0
- `.prettierrc` has singleQuote, trailingComma: all, printWidth: 100
- `.env.example` contains all 13 EXPO_PUBLIC_ keys (7 Firebase + 2 RevenueCat + 4 Unity Ads) with empty values
- `.vscode/settings.json` committed with formatOnSave: true and prettier as default formatter
  </done>
</task>

</tasks>

<verification>
After both tasks complete, run:

```bash
# Full TypeScript check
npx tsc --noEmit
# Expected: 0 errors

# Full lint check
npx eslint . --ext .ts,.tsx --max-warnings=0
# Expected: 0 errors

# Verify app.json has all required fields
node -e "
const cfg = require('./app.json').expo;
console.log('UIBackgroundModes:', cfg.ios.infoPlist.UIBackgroundModes);
console.log('scheme:', cfg.scheme);
console.log('useFrameworks:', JSON.stringify(cfg.plugins.find(p => Array.isArray(p) && p[0] === 'expo-build-properties')));
console.log('plugins count:', cfg.plugins.length);
"
# Expected: UIBackgroundModes: ["audio"], scheme: calm-sounds, useFrameworks: static, plugins: 8

# Verify eas.json profiles
node -e "const e = require('./eas.json'); console.log(Object.keys(e.build))"
# Expected: ['development', 'preview', 'production']
```
</verification>

<success_criteria>
- `npx tsc --noEmit` exits with 0 errors
- `npx eslint . --ext .ts,.tsx --max-warnings=0` exits with 0 errors
- `app.json` contains `UIBackgroundModes: ["audio"]`, `useFrameworks: static`, `scheme: "calm-sounds"`, and 8 plugins (expo-router + 5 RNFB + expo-build-properties + expo-audio)
- `eas.json` has development (developmentClient: true), preview, production profiles
- `.env.example` has all 13 EXPO_PUBLIC_ keys with empty values (no real secrets)
- `.husky/pre-commit` exists and runs `npx lint-staged`
- `.gitignore` includes `.env` but NOT `google-services.json` or `GoogleService-Info.plist`
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md` following the summary template.
</output>
