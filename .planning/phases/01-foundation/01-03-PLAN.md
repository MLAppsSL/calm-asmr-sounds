---
phase: 01-foundation
plan: "03"
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - app/_layout.tsx
  - app/player.tsx
  - app/(tabs)/_layout.tsx
  - app/(tabs)/index.tsx
  - app/(tabs)/favorites.tsx
  - app/(tabs)/settings.tsx
  - app/(onboarding)/_layout.tsx
  - app/(onboarding)/index.tsx
  - app/(auth)/_layout.tsx
  - app/(auth)/sign-in.tsx
  - app/(auth)/sign-up.tsx
  - src/stores/audioStore.ts
  - src/stores/authStore.ts
  - src/stores/favoritesStore.ts
  - src/stores/uiStore.ts
  - src/types/index.ts
autonomous: true

requirements: []

must_haves:
  truths:
    - "Running `npx expo start` launches without runtime errors (Expo Router resolves all routes)"
    - "All 11 route files exist in the `app/` directory with valid default exports"
    - "All 4 Zustand stores export their hooks (useAudioStore, useAuthStore, useFavoritesStore, useUIStore)"
    - "TypeScript reports 0 errors across all created files"
    - "The tab navigator defines exactly 3 tabs: Library (index), Favorites, Settings"
    - "The player route is configured as a modal presentation (not a tab)"
  artifacts:
    - path: "app/_layout.tsx"
      provides: "Root Stack layout — entry point for all routes"
      contains: "Stack"
    - path: "app/(tabs)/_layout.tsx"
      provides: "Tab navigator with 3 tabs"
      contains: "Tabs"
    - path: "app/player.tsx"
      provides: "Player modal route placeholder"
      contains: "export default"
    - path: "src/stores/audioStore.ts"
      provides: "Audio playback state"
      exports: ["useAudioStore"]
    - path: "src/stores/authStore.ts"
      provides: "Authentication state"
      exports: ["useAuthStore"]
    - path: "src/stores/favoritesStore.ts"
      provides: "Favorites state"
      exports: ["useFavoritesStore"]
    - path: "src/stores/uiStore.ts"
      provides: "UI state (dark mode, onboarding)"
      exports: ["useUIStore"]
    - path: "src/types/index.ts"
      provides: "Shared TypeScript type definitions"
      exports: ["Sound", "SoundCategory", "TimerDuration"]
  key_links:
    - from: "app/_layout.tsx"
      to: "app/(tabs)/_layout.tsx"
      via: "Stack.Screen name=(tabs)"
      pattern: "\\(tabs\\)"
    - from: "app/_layout.tsx"
      to: "app/player.tsx"
      via: "Stack.Screen name=player presentation=modal"
      pattern: "presentation.*modal"
    - from: "app/(tabs)/_layout.tsx"
      to: "app/(tabs)/index.tsx"
      via: "Tabs.Screen name=index"
      pattern: "name.*index"
---

<objective>
Scaffold the full Expo Router route skeleton and all four Zustand stores. Every route is a placeholder screen — no product functionality yet. The stores define interfaces and initial state that Phase 2+ will fill in with real logic.

Purpose: Establishing the full navigation structure and store interfaces now prevents architectural drift in later phases. All future UI phases import from these stores and route files. Scaffold now means later phases extend, not create from scratch.

Output: 11 route files (app/ directory), 4 Zustand stores (src/stores/), shared types (src/types/index.ts).
</objective>

<execution_context>
@/Users/manuelfrancogiraldez/.claude/get-shit-done/workflows/execute-plan.md
@/Users/manuelfrancogiraldez/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Expo Router full route skeleton (app/ directory)</name>
  <files>
    app/_layout.tsx
    app/player.tsx
    app/(tabs)/_layout.tsx
    app/(tabs)/index.tsx
    app/(tabs)/favorites.tsx
    app/(tabs)/settings.tsx
    app/(onboarding)/_layout.tsx
    app/(onboarding)/index.tsx
    app/(auth)/_layout.tsx
    app/(auth)/sign-in.tsx
    app/(auth)/sign-up.tsx
  </files>
  <action>
Create all route files per the locked decision: 3 tabs (Library, Favorites, Settings), player as modal, onboarding as separate route group, auth as separate route group.

**Critical rules for Expo Router:**
- The `app/` directory is exclusively for routes — no component logic here
- All screen components import from `src/` — route files are thin shells
- Do NOT add `export const options` or other route config that requires actual navigation state — keep placeholders minimal

**app/_layout.tsx — Root Stack layout:**
```typescript
import { Stack } from 'expo-router';

export default function RootLayout() {
  return (
    <Stack>
      <Stack.Screen name="(tabs)" options={{ headerShown: false }} />
      <Stack.Screen name="(onboarding)" options={{ headerShown: false }} />
      <Stack.Screen name="(auth)" options={{ headerShown: false }} />
      <Stack.Screen
        name="player"
        options={{
          presentation: 'modal',
          headerShown: false,
        }}
      />
    </Stack>
  );
}
```

**app/player.tsx — Player modal placeholder:**
```typescript
import { View, Text, StyleSheet } from 'react-native';

export default function PlayerScreen() {
  return (
    <View style={styles.container}>
      <Text style={styles.text}>Player</Text>
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#000',
    alignItems: 'center',
    justifyContent: 'center',
  },
  text: { color: '#fff', fontSize: 18 },
});
```

**app/(tabs)/_layout.tsx — Tab navigator (3 tabs: Library, Favorites, Settings):**
```typescript
import { Tabs } from 'expo-router';

export default function TabLayout() {
  return (
    <Tabs
      screenOptions={{
        headerShown: false,
        tabBarStyle: { backgroundColor: '#000' },
        tabBarActiveTintColor: '#fff',
        tabBarInactiveTintColor: '#666',
      }}
    >
      <Tabs.Screen name="index" options={{ title: 'Library' }} />
      <Tabs.Screen name="favorites" options={{ title: 'Favorites' }} />
      <Tabs.Screen name="settings" options={{ title: 'Settings' }} />
    </Tabs>
  );
}
```

**app/(tabs)/index.tsx — Library tab placeholder:**
```typescript
import { View, Text, StyleSheet } from 'react-native';

export default function LibraryScreen() {
  return (
    <View style={styles.container}>
      <Text style={styles.text}>Library</Text>
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#000',
    alignItems: 'center',
    justifyContent: 'center',
  },
  text: { color: '#fff', fontSize: 18 },
});
```

**app/(tabs)/favorites.tsx — Favorites tab placeholder:**
```typescript
import { View, Text, StyleSheet } from 'react-native';

export default function FavoritesScreen() {
  return (
    <View style={styles.container}>
      <Text style={styles.text}>Favorites</Text>
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#000',
    alignItems: 'center',
    justifyContent: 'center',
  },
  text: { color: '#fff', fontSize: 18 },
});
```

**app/(tabs)/settings.tsx — Settings tab placeholder:**
```typescript
import { View, Text, StyleSheet } from 'react-native';

export default function SettingsScreen() {
  return (
    <View style={styles.container}>
      <Text style={styles.text}>Settings</Text>
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#000',
    alignItems: 'center',
    justifyContent: 'center',
  },
  text: { color: '#fff', fontSize: 18 },
});
```

**app/(onboarding)/_layout.tsx:**
```typescript
import { Stack } from 'expo-router';

export default function OnboardingLayout() {
  return <Stack screenOptions={{ headerShown: false }} />;
}
```

**app/(onboarding)/index.tsx — Welcome screen placeholder:**
```typescript
import { View, Text, StyleSheet } from 'react-native';

export default function OnboardingScreen() {
  return (
    <View style={styles.container}>
      <Text style={styles.headline}>Toca un sonido. Respira.</Text>
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#000',
    alignItems: 'center',
    justifyContent: 'center',
    paddingHorizontal: 32,
  },
  headline: {
    color: '#fff',
    fontSize: 28,
    textAlign: 'center',
    fontWeight: '300',
  },
});
```

**app/(auth)/_layout.tsx:**
```typescript
import { Stack } from 'expo-router';

export default function AuthLayout() {
  return <Stack screenOptions={{ headerShown: false }} />;
}
```

**app/(auth)/sign-in.tsx — Sign-in placeholder:**
```typescript
import { View, Text, StyleSheet } from 'react-native';

export default function SignInScreen() {
  return (
    <View style={styles.container}>
      <Text style={styles.text}>Sign In</Text>
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#000',
    alignItems: 'center',
    justifyContent: 'center',
  },
  text: { color: '#fff', fontSize: 18 },
});
```

**app/(auth)/sign-up.tsx — Sign-up placeholder:**
```typescript
import { View, Text, StyleSheet } from 'react-native';

export default function SignUpScreen() {
  return (
    <View style={styles.container}>
      <Text style={styles.text}>Sign Up</Text>
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#000',
    alignItems: 'center',
    justifyContent: 'center',
  },
  text: { color: '#fff', fontSize: 18 },
});
```
  </action>
  <verify>
```bash
# TypeScript check across all route files
npx tsc --noEmit

# Verify all 11 route files exist
ls app/_layout.tsx app/player.tsx \
   app/\(tabs\)/_layout.tsx app/\(tabs\)/index.tsx app/\(tabs\)/favorites.tsx app/\(tabs\)/settings.tsx \
   app/\(onboarding\)/_layout.tsx app/\(onboarding\)/index.tsx \
   app/\(auth\)/_layout.tsx app/\(auth\)/sign-in.tsx app/\(auth\)/sign-up.tsx

# Verify player is configured as modal
grep "modal" app/_layout.tsx

# Verify tabs layout has exactly 3 Tabs.Screen entries
grep "Tabs.Screen" app/\(tabs\)/_layout.tsx | wc -l
# Expected: 3
```
  </verify>
  <done>
- All 11 route files exist with valid default exports and no TypeScript errors
- `app/_layout.tsx` has Stack with 4 screens: (tabs), (onboarding), (auth), player (modal)
- `app/(tabs)/_layout.tsx` has exactly 3 Tabs.Screen: index (Library), favorites, settings
- `app/player.tsx` is a modal-presented screen (not a tab)
- `app/(onboarding)/index.tsx` shows "Toca un sonido. Respira." text
  </done>
</task>

<task type="auto">
  <name>Task 2: Zustand stores and shared TypeScript types</name>
  <files>
    src/stores/audioStore.ts
    src/stores/authStore.ts
    src/stores/favoritesStore.ts
    src/stores/uiStore.ts
    src/types/index.ts
  </files>
  <action>
Create `src/types/` and `src/stores/` directories. Create all 4 Zustand stores and the shared types file.

**Zustand v5 TypeScript pattern** — always use `create<T>()()` double-parentheses. Using `create<T>()` (single parens) causes type inference failures in v5. See research Pattern 4.

**Note on `useShallow`:** When a component needs to select multiple values from a store simultaneously, use `useShallow` from `zustand/react/shallow` to avoid infinite re-render loops (Pitfall 4 in research). Document this in each store file as a comment.

---

**src/types/index.ts — Shared domain types:**
```typescript
// src/types/index.ts
// Shared TypeScript types used across all phases.
// Phase 2+ will extend Sound and SoundCategory as the catalog is built out.

export type SoundCategory = 'rain' | 'fire' | 'forest' | 'ocean' | 'wind' | 'white-noise';

export type TimerDuration = 60 | 120 | 180; // seconds: 1 min, 2 min, 3 min

export interface Sound {
  id: string;
  title: string;
  category: SoundCategory;
  durationSeconds: TimerDuration;
  isPremium: boolean;
  storageUrl: string | null; // null until resolved from Firebase Storage
  thumbnailUrl: string | null;
}

export interface User {
  uid: string;
  email: string | null;
  isAnonymous: boolean;
}
```

---

**src/stores/audioStore.ts:**
```typescript
// src/stores/audioStore.ts
// Zustand v5 pattern: create<T>()() — double parens required for TypeScript inference.
// When selecting multiple values in components, use useShallow from 'zustand/react/shallow'
// to prevent infinite re-render loops (Zustand v5 behavior change).
import { create } from 'zustand';

interface AudioState {
  currentSoundId: string | null;
  isPlaying: boolean;
  isLooping: boolean;
  timerSeconds: number | null; // null = no timer (infinity mode)
  volume: number; // 0.0 – 1.0
  setCurrentSound: (id: string | null) => void;
  setIsPlaying: (playing: boolean) => void;
  setIsLooping: (looping: boolean) => void;
  setTimer: (seconds: number | null) => void;
  setVolume: (volume: number) => void;
  reset: () => void;
}

const initialState = {
  currentSoundId: null,
  isPlaying: false,
  isLooping: false,
  timerSeconds: 60, // default: 1-minute timer
  volume: 1.0,
};

export const useAudioStore = create<AudioState>()((set) => ({
  ...initialState,
  setCurrentSound: (id) => set({ currentSoundId: id }),
  setIsPlaying: (playing) => set({ isPlaying: playing }),
  setIsLooping: (looping) => set({ isLooping: looping }),
  setTimer: (seconds) => set({ timerSeconds: seconds }),
  setVolume: (volume) => set({ volume }),
  reset: () => set(initialState),
}));
```

---

**src/stores/authStore.ts:**
```typescript
// src/stores/authStore.ts
// Zustand v5 pattern: create<T>()() — double parens required for TypeScript inference.
import { create } from 'zustand';
import type { User } from '../types';

interface AuthState {
  user: User | null;
  isLoading: boolean; // true until first auth state resolved
  setUser: (user: User | null) => void;
  setLoading: (loading: boolean) => void;
}

export const useAuthStore = create<AuthState>()((set) => ({
  user: null,
  isLoading: true, // start loading until RNFB resolves auth state
  setUser: (user) => set({ user }),
  setLoading: (loading) => set({ isLoading: loading }),
}));
```

---

**src/stores/favoritesStore.ts:**
```typescript
// src/stores/favoritesStore.ts
// Zustand v5 pattern: create<T>()() — double parens required for TypeScript inference.
// Phase 4 will add persistence (AsyncStorage adapter).
// Phase 5 will add cloud sync (Firestore adapter).
import { create } from 'zustand';

interface FavoritesState {
  favoriteIds: string[];
  addFavorite: (id: string) => void;
  removeFavorite: (id: string) => void;
  isFavorite: (id: string) => boolean;
  setFavorites: (ids: string[]) => void; // used by Phase 5 migration
}

export const useFavoritesStore = create<FavoritesState>()((set, get) => ({
  favoriteIds: [],
  addFavorite: (id) =>
    set((state) => ({
      favoriteIds: state.favoriteIds.includes(id)
        ? state.favoriteIds
        : [...state.favoriteIds, id],
    })),
  removeFavorite: (id) =>
    set((state) => ({
      favoriteIds: state.favoriteIds.filter((f) => f !== id),
    })),
  isFavorite: (id) => get().favoriteIds.includes(id),
  setFavorites: (ids) => set({ favoriteIds: ids }),
}));
```

---

**src/stores/uiStore.ts:**
```typescript
// src/stores/uiStore.ts
// Zustand v5 pattern: create<T>()() — double parens required for TypeScript inference.
import { create } from 'zustand';

interface UIState {
  isDarkMode: boolean;
  hasSeenOnboarding: boolean;
  isImmersiveMode: boolean; // Phase 3: hides all UI, shows only background + audio
  isPlayerVisible: boolean; // player modal open state
  setDarkMode: (dark: boolean) => void;
  setHasSeenOnboarding: (seen: boolean) => void;
  setImmersiveMode: (immersive: boolean) => void;
  setPlayerVisible: (visible: boolean) => void;
}

export const useUIStore = create<UIState>()((set) => ({
  isDarkMode: true, // dark mode ON by default per requirements
  hasSeenOnboarding: false,
  isImmersiveMode: false,
  isPlayerVisible: false,
  setDarkMode: (dark) => set({ isDarkMode: dark }),
  setHasSeenOnboarding: (seen) => set({ hasSeenOnboarding: seen }),
  setImmersiveMode: (immersive) => set({ isImmersiveMode: immersive }),
  setPlayerVisible: (visible) => set({ isPlayerVisible: visible }),
}));
```
  </action>
  <verify>
```bash
# TypeScript check across all store files and types
npx tsc --noEmit

# Verify all store files exist
ls src/stores/audioStore.ts src/stores/authStore.ts \
   src/stores/favoritesStore.ts src/stores/uiStore.ts src/types/index.ts

# Verify Zustand v5 double-parens pattern in each store
grep "create<" src/stores/audioStore.ts
# Expected: create<AudioState>()( — note the double ()

# Verify exports
grep "export const use" src/stores/audioStore.ts src/stores/authStore.ts \
  src/stores/favoritesStore.ts src/stores/uiStore.ts

# Verify types file has Sound interface
grep "export interface Sound" src/types/index.ts
```
  </verify>
  <done>
- `src/types/index.ts` exports Sound, SoundCategory, TimerDuration, User types
- `src/stores/audioStore.ts` exports useAudioStore with currentSoundId, isPlaying, isLooping, timerSeconds, volume + setters + reset
- `src/stores/authStore.ts` exports useAuthStore with user (User | null), isLoading + setters
- `src/stores/favoritesStore.ts` exports useFavoritesStore with favoriteIds, addFavorite, removeFavorite, isFavorite, setFavorites
- `src/stores/uiStore.ts` exports useUIStore with isDarkMode (true default), hasSeenOnboarding, isImmersiveMode, isPlayerVisible + setters
- All stores use `create<T>()()` double-parens Zustand v5 pattern
- `npx tsc --noEmit` passes with 0 errors across all files
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

```bash
# Full TypeScript check across entire project
npx tsc --noEmit
# Expected: 0 errors

# All route files have default exports
for f in app/_layout.tsx app/player.tsx \
  "app/(tabs)/_layout.tsx" "app/(tabs)/index.tsx" "app/(tabs)/favorites.tsx" "app/(tabs)/settings.tsx" \
  "app/(onboarding)/_layout.tsx" "app/(onboarding)/index.tsx" \
  "app/(auth)/_layout.tsx" "app/(auth)/sign-in.tsx" "app/(auth)/sign-up.tsx"; do
  grep -l "export default" "$f" && echo "OK: $f" || echo "MISSING default export: $f"
done

# All stores export hooks
grep "export const use" src/stores/*.ts | wc -l
# Expected: 4

# Player is modal
grep "modal" app/_layout.tsx
# Expected: presentation: 'modal'

# uiStore defaults dark mode to true
grep "isDarkMode: true" src/stores/uiStore.ts
```
</verification>

<success_criteria>
- 11 route files exist in `app/` with valid default exports and 0 TypeScript errors
- 3 tabs defined: Library (index), Favorites, Settings — in that order
- Player configured as modal presentation in root Stack
- 4 Zustand stores scaffolded with complete interfaces and initial state (all using `create<T>()()` pattern)
- `src/types/index.ts` defines Sound, SoundCategory, TimerDuration, User
- `npx tsc --noEmit` passes across all created files
- `npx eslint . --ext .ts,.tsx --max-warnings=0` passes
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-03-SUMMARY.md` following the summary template.
</output>
