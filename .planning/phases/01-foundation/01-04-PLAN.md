---
phase: 01-foundation
plan: "04"
type: execute
wave: 3
depends_on: ["01-02", "01-03"]
files_modified: []
autonomous: false
requirements: []

must_haves:
  truths:
    - "`eas build --profile development` produces an installable IPA (iOS) and APK/AAB (Android) with no native errors"
    - "The built Development Build installs and launches on a real iOS device without crashing"
    - "The built Development Build installs and launches on a real Android device without crashing"
    - "Firebase Auth, Firestore, and Storage are reachable from within the installed app without 'app not initialized' or network errors"
    - "`UIBackgroundModes: [audio]` is present in the built iOS app's Info.plist"
  artifacts:
    - path: "eas.json"
      provides: "EAS build profiles used to trigger the build"
      contains: "developmentClient"
    - path: "google-services.json"
      provides: "Android Firebase native config (must be present for Android build to succeed)"
      contains: "project_id"
    - path: "GoogleService-Info.plist"
      provides: "iOS Firebase native config (must be present for iOS build to succeed)"
      contains: "PROJECT_ID"
  key_links:
    - from: "eas.json build.development"
      to: "EAS Build service"
      via: "eas build --profile development"
      pattern: "developmentClient"
    - from: "app.json ios.infoPlist.UIBackgroundModes"
      to: "Built iOS Info.plist"
      via: "EAS Build native compilation"
      pattern: "UIBackgroundModes"
    - from: "google-services.json / GoogleService-Info.plist"
      to: "RNFB native module initialization"
      via: "EAS Build bundle inclusion"
      pattern: "project_id"
---

<objective>
Trigger EAS Development Builds for iOS and Android, install the resulting artifacts on real devices, and verify the app launches cleanly with Firebase connectivity. This is the phase gate for Phase 1.

Purpose: Plans 01-01 through 01-03 configure the build infrastructure but never prove the native build actually works on real hardware. This plan closes that gap. SC1 (eas build produces installable builds) and SC3 (app runs without errors on real devices) cannot be verified without triggering an actual build and physically testing on device — there is no emulator substitute for native background audio and RNFB initialization.

Output: Confirmed Development Build artifacts installed on real iOS and Android devices, with Firebase connectivity verified.
</objective>

<execution_context>
@/Users/manuelfrancogiraldez/.claude/get-shit-done/workflows/execute-plan.md
@/Users/manuelfrancogiraldez/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-02-SUMMARY.md
@.planning/phases/01-foundation/01-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Trigger EAS Development Builds for iOS and Android</name>
  <files></files>
  <action>
Run EAS builds for both platforms using the `development` profile. This profile sets `developmentClient: true` and `distribution: internal`, which produces an installable artifact (IPA for iOS, APK for Android) containing expo-dev-client and all native modules (RNFB, expo-audio).

```bash
# Authenticate with EAS (if not already logged in)
eas whoami || eas login

# Trigger both builds in parallel (they run on EAS servers)
eas build --platform all --profile development --non-interactive
```

If you prefer to trigger them separately to monitor output:
```bash
eas build --platform ios --profile development
eas build --platform android --profile development
```

**What to expect:**
- EAS will prompt to configure the project on first run — accept defaults for internal distribution
- iOS build produces a `.ipa` file distributed via EAS's internal distribution URL
- Android build produces an `.apk` file (not `.aab`) for direct sideloading
- Build times: typically 15-30 minutes per platform on EAS servers
- The build URLs and QR codes will be printed to stdout and available at https://expo.dev

**If the build fails:**
- iOS error "non-modular header" → confirm `expo-build-properties` with `useFrameworks: static` is in `app.json` plugins
- Android error "google-services.json not found" → confirm the file is at the project root (not in android/ subdirectory)
- RNFB plugin error → confirm all 5 RNFB plugins are listed in `app.json` plugins array
  </action>
  <verify>
```bash
# Check EAS build status
eas build:list --limit 2

# Expected output shows two builds with status "finished" or "in progress":
# Build for ios  — profile: development — status: finished
# Build for android — profile: development — status: finished
```
  </verify>
  <done>
- Both iOS and Android builds complete with status "finished" on EAS (not "errored" or "cancelled")
- EAS provides download/install URLs or QR codes for both artifacts
- No native compilation errors in build logs
  </done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 2: Install on real devices and verify app launches with Firebase connectivity</name>
  <files></files>
  <action>
Install the Development Build artifacts on real iOS and Android devices and verify the app launches correctly. This step requires physical hardware — it cannot be done with simulators because UIBackgroundModes and RNFB initialization must be verified on real devices per the research findings.

**iOS installation:**

1. From the EAS build output URL (or https://expo.dev -> your project -> Builds), open the iOS build
2. Install via QR code or Expo Orbit:
   - **Option A (QR code):** Scan the QR code on your iPhone to install via Safari (device must be registered in Apple Developer portal or use TestFlight internal testing)
   - **Option B (Expo Orbit):** Install Expo Orbit on your Mac (https://expo.dev/orbit), connect iPhone via USB, select the build and click Install
3. Launch the app on the iOS device

**Android installation:**

1. From the EAS build output, download the `.apk` file
2. Transfer to Android device via ADB or USB file transfer:
   ```bash
   # Via ADB (if device connected with USB debugging enabled)
   adb install <path-to-downloaded.apk>
   ```
   Or transfer the APK file to the device and open it to sideload
3. Launch the app on the Android device

**Verification checklist — run on EACH device:**

1. **App launches without crash:** The app opens to the Library placeholder screen ("Library" text visible). No red error screen, no native crash dialog.

2. **No "app not initialized" error:** Open the React Native DevTools or check the Metro console — no Firebase-related errors should appear on startup. The RNFB modules initialize silently from the bundled native config files.

3. **Firebase Auth is accessible (smoke test):** In the Expo DevTools console, or by temporarily adding a log to `app/_layout.tsx`, confirm that `auth().currentUser` is accessible without throwing. Expected: returns `null` (no user signed in yet) — NOT an exception.

4. **Firebase Firestore is accessible (smoke test):** Confirm that `firestore().collection('test')` can be called without throwing "app not initialized" or "network error on first call". Expected: resolves or returns a CollectionReference without crashing.

5. **UIBackgroundModes present (iOS only):** This will be confirmed by audio working in Phase 2, but as a quick check — open the device Settings -> Calm Sounds -> Background App Refresh should be available (indicates background modes are registered).

6. **No Metro bundler required for basic launch:** The app should launch from the installed artifact without needing the Metro server running (it bundles JS at build time for the development profile).

Type "build verified" when all checks pass on both devices, or describe any failures.
  </action>
  <verify>
```bash
# Confirm EAS builds are finished before attempting install
eas build:list --limit 2 --json | node -e "
  const builds = JSON.parse(require('fs').readFileSync('/dev/stdin','utf8'));
  builds.forEach(b => console.log(b.platform, b.status, b.artifacts?.buildUrl || 'no url'));
"
```
  </verify>
  <done>
- iOS Development Build installs and launches on a real iOS device with no crash on startup
- Android Development Build installs and launches on a real Android device with no crash on startup
- `auth().currentUser` returns `null` (not an exception) — confirming RNFB Auth initialized from GoogleService-Info.plist / google-services.json
- `firestore().collection('test')` returns a CollectionReference without throwing "app not initialized" — confirming Firestore initialized
- Storage module is accessible without error (smoke test: `storage().ref('test')` does not throw)
- No red error screen on first launch on either device
- SC1 confirmed: EAS build produced installable Development Builds for both iOS and Android
- SC3 confirmed: App runs without errors on real iOS and Android devices
- SC4 confirmed (runtime): Firebase Auth, Firestore, and Storage connect without "app not initialized" errors on device
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

```bash
# Confirm both builds are in finished state
eas build:list --limit 4

# Expected: two "finished" builds for the development profile (ios + android)
# Build artifacts installed and tested on real devices per checkpoint above
```

Phase 1 is complete when:
- Both EAS builds finish without native errors
- App launches clean on real iOS and Android hardware
- Firebase modules initialize without errors (confirmed via smoke test in checkpoint)
</verification>

<success_criteria>
- `eas build --profile development` produces installable artifacts for both iOS and Android (SC1)
- The built app launches without errors on a real iOS device — no crash, no red screen (SC3)
- The built app launches without errors on a real Android device — no crash, no red screen (SC3)
- Firebase Auth: `auth().currentUser` accessible without exception on device (SC4 runtime verification)
- Firebase Firestore: `firestore().collection(...)` callable without "app not initialized" error on device (SC4 runtime verification)
- Firebase Storage: `storage().ref(...)` callable without error on device (SC4 runtime verification)
- `UIBackgroundModes: ["audio"]` verified present in the installed iOS build (SC2)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-04-SUMMARY.md` following the summary template.
</output>
