---
phase: 01-foundation
plan: "02"
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - google-services.json
  - GoogleService-Info.plist
  - src/lib/firebase.ts
autonomous: false

requirements: []

user_setup:
  - service: firebase
    why: "Native Firebase SDK — RNFB reads google-services.json / GoogleService-Info.plist directly at build time. These files cannot be generated by Claude."
    env_vars:
      - name: EXPO_PUBLIC_FIREBASE_API_KEY
        source: "Firebase Console -> Project Settings -> General -> Your apps -> Web app -> Config"
      - name: EXPO_PUBLIC_FIREBASE_AUTH_DOMAIN
        source: "Firebase Console -> Project Settings -> General -> Your apps -> Web app -> Config"
      - name: EXPO_PUBLIC_FIREBASE_PROJECT_ID
        source: "Firebase Console -> Project Settings -> General -> Your apps -> Web app -> Config"
      - name: EXPO_PUBLIC_FIREBASE_STORAGE_BUCKET
        source: "Firebase Console -> Project Settings -> General -> Your apps -> Web app -> Config"
      - name: EXPO_PUBLIC_FIREBASE_MESSAGING_SENDER_ID
        source: "Firebase Console -> Project Settings -> General -> Your apps -> Web app -> Config"
      - name: EXPO_PUBLIC_FIREBASE_APP_ID
        source: "Firebase Console -> Project Settings -> General -> Your apps -> Web app -> Config"
      - name: EXPO_PUBLIC_FIREBASE_MEASUREMENT_ID
        source: "Firebase Console -> Project Settings -> General -> Your apps -> Web app -> Config"
    dashboard_config:
      - task: "Create Firebase project"
        location: "Firebase Console (console.firebase.google.com) -> Add project -> Name: calm-asmr-sounds -> Enable Google Analytics"
      - task: "Register iOS app"
        location: "Firebase Console -> Project Settings -> Add app -> iOS -> Bundle ID: com.calmsounds.app -> Download GoogleService-Info.plist -> place at project root"
      - task: "Register Android app"
        location: "Firebase Console -> Project Settings -> Add app -> Android -> Package: com.calmsounds.app -> Download google-services.json -> place at project root"
      - task: "Enable Email/Password authentication"
        location: "Firebase Console -> Authentication -> Sign-in method -> Email/Password -> Enable"
      - task: "Enable Anonymous authentication"
        location: "Firebase Console -> Authentication -> Sign-in method -> Anonymous -> Enable"
      - task: "Create Firestore database"
        location: "Firebase Console -> Firestore Database -> Create database -> Start in test mode -> Choose region (us-central1 recommended)"
      - task: "Create Storage bucket"
        location: "Firebase Console -> Storage -> Get started -> Start in test mode -> Choose region matching Firestore"

must_haves:
  truths:
    - "The app can import from `src/lib/firebase.ts` without TypeScript errors"
    - "RNFB modules (auth, firestore, storage, analytics) are accessible as named exports from `src/lib/firebase.ts`"
    - "google-services.json exists at the project root and contains a valid Firebase project configuration"
    - "GoogleService-Info.plist exists at the project root and contains a valid Firebase project configuration"
  artifacts:
    - path: "src/lib/firebase.ts"
      provides: "Firebase service exports (auth, firestore, storage, analytics)"
      exports: ["auth", "firestore", "storage", "analytics"]
    - path: "google-services.json"
      provides: "Android Firebase native config"
      contains: "project_id"
    - path: "GoogleService-Info.plist"
      provides: "iOS Firebase native config"
      contains: "PROJECT_ID"
  key_links:
    - from: "app.json"
      to: "google-services.json"
      via: "android.googleServicesFile config"
      pattern: "googleServicesFile"
    - from: "app.json"
      to: "GoogleService-Info.plist"
      via: "ios.googleServicesFile config"
      pattern: "GoogleService-Info"
    - from: "src/lib/firebase.ts"
      to: "@react-native-firebase/app"
      via: "module import"
      pattern: "@react-native-firebase"
---

<objective>
Initialize Firebase by placing the native config files (google-services.json and GoogleService-Info.plist) in the project root, creating the firebase.ts service module that exports all four RNFB services, and filling in the .env file from .env.example.

Purpose: RNFB requires native config files present at build time — there is no runtime alternative. This plan gates on a human checkpoint to place those files (they come from the Firebase Console and cannot be generated by Claude), then Claude wires up the firebase.ts module that all future phases import from.

Output: `src/lib/firebase.ts` exporting auth, firestore, storage, analytics; both native config files at project root; `.env` populated with Firebase web SDK config values.
</objective>

<execution_context>
@/Users/manuelfrancogiraldez/.claude/get-shit-done/workflows/execute-plan.md
@/Users/manuelfrancogiraldez/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 1: Firebase project setup and native config file placement</name>
  <files>
    google-services.json
    GoogleService-Info.plist
  </files>
  <action>
Complete the Firebase project setup and place the native config files at the project root. These files cannot be generated by Claude — they come from the Firebase Console and contain platform-specific credentials that RNFB reads at native build time.

**Steps to complete:**

1. Go to https://console.firebase.google.com
2. Click "Add project" → Name: `calm-asmr-sounds` → Enable Google Analytics → Create project

3. **Register iOS app:**
   - Project Settings → Add app → iOS
   - iOS bundle ID: `com.calmsounds.app`
   - App nickname: `Calm Sounds iOS`
   - Download `GoogleService-Info.plist`
   - Place it at the **project root** (same directory as `app.json`)

4. **Register Android app:**
   - Project Settings → Add app → Android
   - Android package: `com.calmsounds.app`
   - App nickname: `Calm Sounds Android`
   - Download `google-services.json`
   - Place it at the **project root** (same directory as `app.json`)

5. **Enable Authentication:**
   - Firebase Console → Authentication → Get started → Sign-in method
   - Enable: Email/Password
   - Enable: Anonymous

6. **Create Firestore database:**
   - Firebase Console → Firestore Database → Create database
   - Start in **test mode** (Security Rules will be locked down in Phase 5)
   - Region: `us-central1` (or nearest to your location)

7. **Create Storage bucket:**
   - Firebase Console → Storage → Get started
   - Start in **test mode**
   - Region: same as Firestore

8. **Copy Firebase web SDK config to .env:**
   - Firebase Console → Project Settings → General → scroll to "Your apps" → Web app (add one if it doesn't exist with nickname "Calm Sounds Web")
   - Copy the config values into your `.env` file (copy from `.env.example` as a starting template):
     ```
     EXPO_PUBLIC_FIREBASE_API_KEY=<apiKey>
     EXPO_PUBLIC_FIREBASE_AUTH_DOMAIN=<authDomain>
     EXPO_PUBLIC_FIREBASE_PROJECT_ID=<projectId>
     EXPO_PUBLIC_FIREBASE_STORAGE_BUCKET=<storageBucket>
     EXPO_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=<messagingSenderId>
     EXPO_PUBLIC_FIREBASE_APP_ID=<appId>
     EXPO_PUBLIC_FIREBASE_MEASUREMENT_ID=<measurementId>
     ```

9. Verify both files are at the project root before resuming:
   - `./google-services.json` → should contain `"project_id"`
   - `./GoogleService-Info.plist` → should contain `PROJECT_ID`
  </action>
  <verify>
```bash
# Verify both native config files are present at project root
ls -la google-services.json GoogleService-Info.plist
# Expected: both files listed with non-zero size

# Verify google-services.json has project_id
node -e "const g = require('./google-services.json'); console.log('project_id:', g.project_info.project_id)"
# Expected: project_id: <your-firebase-project-id>

# Verify .env exists and has Firebase values
grep -c "EXPO_PUBLIC_FIREBASE" .env
# Expected: 7
```
  </verify>
  <done>
- `google-services.json` exists at project root with a valid `project_info.project_id` field
- `GoogleService-Info.plist` exists at project root with a valid `PROJECT_ID` key
- `.env` exists locally (gitignored) with all 7 EXPO_PUBLIC_FIREBASE_* values populated
- Firebase project has Email/Password auth, Anonymous auth, Firestore (test mode), and Storage (test mode) all enabled
- Type "firebase ready" to resume Claude execution
  </done>
</task>

<task type="auto">
  <name>Task 2: Create src/lib/firebase.ts Firebase service module</name>
  <files>
    src/lib/firebase.ts
  </files>
  <action>
Create the directory `src/lib/` if it does not exist, then create `src/lib/firebase.ts`.

**Important RNFB behavior:** Unlike the Firebase JS SDK, RNFB does NOT require calling `initializeApp()`. The native modules auto-initialize from `google-services.json` / `GoogleService-Info.plist` referenced in `app.json`. Calling `initializeApp()` from the Firebase JS SDK alongside RNFB creates a "dual package hazard" that causes runtime errors — do NOT do this.

```typescript
// src/lib/firebase.ts
// React Native Firebase (RNFB) — auto-initializes from native config files.
// Do NOT call initializeApp() — RNFB handles initialization natively.
// All 4 services initialized per Phase 1 locked decision.
import auth from '@react-native-firebase/auth';
import firestore from '@react-native-firebase/firestore';
import storage from '@react-native-firebase/storage';
import analytics from '@react-native-firebase/analytics';

export { auth, firestore, storage, analytics };
```

That is the entire file. RNFB's module system handles all initialization. Each imported function is a getter that returns the initialized service instance.

Verify TypeScript accepts it:
```bash
npx tsc --noEmit
```
  </action>
  <verify>
```bash
# TypeScript check
npx tsc --noEmit
# Expected: 0 errors

# Verify file exists and has correct exports
grep "export" src/lib/firebase.ts
# Expected: export { auth, firestore, storage, analytics };

# Verify no initializeApp call (anti-pattern check)
grep "initializeApp" src/lib/firebase.ts
# Expected: no output (initializeApp must NOT be present)

# Verify both native config files are present
ls -la google-services.json GoogleService-Info.plist
# Expected: both files listed with non-zero size
```
  </verify>
  <done>
- `src/lib/firebase.ts` exports auth, firestore, storage, analytics from RNFB modules with NO initializeApp() call
- `npx tsc --noEmit` passes with 0 errors on the firebase.ts file
- `google-services.json` exists at project root with valid Firebase project config
- `GoogleService-Info.plist` exists at project root with valid Firebase project config
- `.env` is populated with all 7 EXPO_PUBLIC_FIREBASE_* values (file is gitignored, not committed)
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

```bash
# TypeScript clean
npx tsc --noEmit

# Firebase module resolves
node -e "console.log('firebase.ts exists:', require('fs').existsSync('./src/lib/firebase.ts'))"

# Both native config files present
ls google-services.json GoogleService-Info.plist

# .env has Firebase values (not committed, but should exist locally)
grep -c "EXPO_PUBLIC_FIREBASE" .env
# Expected: 7

# .env is in .gitignore
grep "^\.env$" .gitignore
# Expected: .env

# No initializeApp in firebase.ts (would cause dual package hazard)
grep "initializeApp" src/lib/firebase.ts || echo "PASS: no initializeApp found"
```
</verification>

<success_criteria>
- `src/lib/firebase.ts` exists and exports `{ auth, firestore, storage, analytics }` from RNFB — NO initializeApp() call
- `google-services.json` and `GoogleService-Info.plist` are at the project root and committed to git (per locked decision)
- `.env` exists locally (gitignored) with all 7 EXPO_PUBLIC_FIREBASE_* values populated
- Firebase project has Auth (email/password + anonymous), Firestore, and Storage enabled
- `npx tsc --noEmit` passes with 0 errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md` following the summary template.
</output>
